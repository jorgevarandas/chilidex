{"version":3,"sources":["assets/js/config.js","assets/js/utils/Events.js","assets/js/utils/MessageBus.js","main.js"],"names":["EVENTS","ACTIONS","PATH","LOCAL_PATH","events","hasProp","hasOwnProperty","Events","event","listener","call","index","push","remove","info","forEach","item","undefined","MessageBus","target","listenForMessages","window","addEventListener","onMessageReceived","bind","obj","message","JSON","stringify","postMessage","evt","messageData","parse","data","action","height","emitEvent","route","Chilidex","checkForRedirect","createIframe","addListeners","redirect","sessionStorage","location","href","history","replaceState","_route","pathname","_iframeSource","iframeId","iframe","document","createElement","mainEl","querySelector","setAttribute","style","width","appendChild","onload","createMessageBus","getElementById","bus","contentWindow","_url","port","hostname","sendMessage","addListener","onHeightUpdated","onRouteChanged"],"mappings":"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","file":"main.18662115.map","sourceRoot":"..","sourcesContent":["export const EVENTS = {\n    'start'  : 'onstart',\n    'route'  : 'onchangedroute',\n    'height' : 'onupdateheight',\n}\n\nexport const ACTIONS = {\n    'start'  : 'start',\n    'route'  : 'route',\n    'height' : 'update-height',\n}\n\nexport const PATH = 'https://chilidex-spa.theysaiditwould.work';\nexport const LOCAL_PATH = 'localhost:1234';\n","const events = {};\nconst hasProp = events.hasOwnProperty;\n\n/**\n * Events class to handle event listening and emiting\n */\nexport default class Events {\n  addListener(event, listener) {\n    // Create the event's object if not yet created\n    if (!hasProp.call(events, event)) events[event] = [];\n\n    // Add the listener to queue\n    const index = events[event].push(listener) - 1;\n\n    // Provide handle back for removal of event\n    return {\n      remove: function () {\n        delete events[event][index];\n      }\n    };\n  }\n\n  emitEvent(event, info) {\n    // If the event doesn't exist, or there's no listeners in queue, just leave\n    if (!hasProp.call(events, event)) return;\n\n    // Cycle through events queue, fire!\n    events[event].forEach(function (item) {\n      item(info != undefined ? info : {});\n    });\n  }\n}\n","\nimport Events from './Events';\nimport { EVENTS, ACTIONS } from '../config';\n\nexport default class MessageBus {\n    constructor(target) {\n        this.target = target;\n        this.events = new Events();\n        this.listenForMessages();\n    }\n\n    listenForMessages() {\n        window.addEventListener('message', this.onMessageReceived.bind(this), false);\n    }\n\n    sendMessage(obj) {\n        // console.log('SEND MESSAGE TO CHILD', obj, JSON.stringify(obj));\n        const message = JSON.stringify(obj);\n        this.target.postMessage(message, '*');\n    }\n\n    onMessageReceived(evt) {\n        const messageData = JSON.parse(evt.data);\n        const action = messageData.action;\n        // console.log('PARENT got a message:', messageData);\n\n        if (action) {\n            switch (action) {\n                case ACTIONS.height:\n                    this.events.emitEvent(EVENTS.height, {\n                        height: messageData.height\n                    });\n                    break;\n                case ACTIONS.route:\n                    this.events.emitEvent(EVENTS.route, {\n                        route: messageData.route,\n                    });\n                    break;\n\n                default:\n                    break;\n            }\n        }\n    }\n}","import './assets/scss/index.scss';\n\nimport { EVENTS, PATH } from './assets/js/config';\nimport Events from './assets/js/utils/Events';\nimport MessageBus from './assets/js/utils/MessageBus';\n\nclass Chilidex {\n    constructor() {\n        this.checkForRedirect();\n        this.createIframe();\n        this.events = new Events();\n        this.addListeners();\n    }\n\n    checkForRedirect() {\n        const redirect = sessionStorage.redirect;\n        delete sessionStorage.redirect;\n\n        if (redirect && redirect != location.href) {\n            this.redirect = redirect;\n            history.replaceState(null, 'Chilidex (Parent)', redirect);\n        }\n    }\n\n    createIframe() {\n        const\n            _route = (this.redirect && this.redirect != location.href) ? this.redirect : window.location.pathname,\n            _iframeSource = `${ PATH + _route }`,\n            _iframeId = 'childSpa';\n\n        this.iframeId = _iframeId;\n\n        // Create the iframe\n        const\n            iframe = document.createElement('iframe'),\n            mainEl = document.querySelector('.main');\n\n        iframe.setAttribute('src', _iframeSource);\n        iframe.setAttribute('id', _iframeId);\n        iframe.style.width = '100%';\n        iframe.style.height = '0';\n\n        mainEl.appendChild(iframe);\n\n        iframe.onload = this.createMessageBus.bind(this);\n    }\n\n    createMessageBus() {\n        const\n            iframe = document.getElementById('childSpa'),\n            bus = new MessageBus(iframe.contentWindow);\n\n        this.iframe = iframe;\n        this.bus = bus;\n\n        let _url = (window.location.port && window.location.port !== '')\n            ? `${window.location.hostname}:${window.location.port}`\n            : window.location.hostname;\n\n        bus.sendMessage({\n            'action': 'start',\n            'parentURL' : `${_url}`\n        });\n    }\n\n    addListeners(){\n        this.events.addListener(EVENTS.height, this.onHeightUpdated.bind(this));\n        this.events.addListener(EVENTS.route, this.onRouteChanged.bind(this));\n    }\n\n    onHeightUpdated(evt) {\n        this.iframe.style.height = '0';\n        this.iframe.style.height = evt.height + 'px';\n    }\n\n    onRouteChanged(evt) {\n        // console.log('PARENT __ onRouteChanged', evt);\n        window.history.replaceState(evt, 'Chilidex (Parent)', evt.route);\n    }\n}\n\nnew Chilidex();"]}